# PR TIMES企業データ管理システム

## 概要

PR TIMESから取得した企業データをCSVで一括登録し、高度な検索・絞り込みを行える管理システムです。

## 主な機能

### 1. 管理者機能 (`/admin/prtimes`)
- **CSVファイル一括アップロード**
  - 17列のCSVデータを一括登録
  - エラーハンドリング機能
  - アップロード結果のレポート表示
- **データ管理**
  - 登録済みデータの一覧表示
  - データ件数の確認

### 2. ユーザー機能 (`/prtimes`)
- **高度な検索・絞り込み**
  - 会社名での部分一致検索
  - 業種、プレスリリースカテゴリ、上場区分での複数選択
  - 資本金範囲での絞り込み
  - 設立年範囲での絞り込み
  - 配信日期間での絞り込み
- **検索結果表示**
  - 会社名とホームページURLのみ表示（要件通り）
  - ページネーション対応
- **CSVエクスポート**
  - 検索結果をCSVファイルでダウンロード

## データ構造（17列）

| 列番号 | 項目名 | 形式例 | 備考 |
|--------|--------|--------|------|
| 1 | 配信日時 | 2025-05-20 22:00:01 | タイムスタンプ形式 |
| 2 | プレスリリースのリンク | https://prtimes.jp/... | URL |
| 3 | プレスリリースのタイトル | 新サービス発表 | テキスト |
| 4 | プレスリリースカテゴリ1 | IT・通信 | 動的カテゴリ管理 |
| 5 | プレスリリースカテゴリ2 | 新サービス | 動的カテゴリ管理 |
| 6 | 会社名 | 株式会社○○ | **必須項目** |
| 7 | 会社URL | https://example.com | **重要項目** |
| 8 | 業種 | IT・通信 | 動的カテゴリ管理 |
| 9 | 住所 | 東京都渋谷区... | テキスト |
| 10 | 電話番号 | 03-1234-5678 | テキスト |
| 11 | 代表者 | 田中太郎 | テキスト |
| 12 | 上場区分 | 東証プライム | 動的カテゴリ管理 |
| 13 | 資本金 | 990万円 | テキスト形式 |
| 14 | 設立日 | 2017年04月 | テキスト形式 |
| 15 | 資本金（数値） | 990 | 万円単位の数値 |
| 16 | 設立年 | 2015 | 数値 |
| 17 | 設立月 | 6 | 数値 |

## セットアップ

### 1. データベースマイグレーション

```bash
npm run db:migrate:prtimes
```

### 2. サンプルデータの確認

`sample-prtimes.csv`ファイルにサンプルデータが含まれています。

### 3. アクセス方法

- **管理者**: `/admin/prtimes` - CSVアップロード機能
- **ユーザー**: `/prtimes` - 検索・エクスポート機能

## 技術仕様

### データベース設計
- **prtimes_companies**: メインデータテーブル
- **prtimes_categories**: 動的カテゴリ管理テーブル
- **インデックス**: 高速検索用の複合インデックス

### API エンドポイント
- `GET /api/prtimes` - データ取得
- `POST /api/prtimes/search` - 検索
- `GET /api/prtimes/categories` - カテゴリ取得
- `POST /api/prtimes/upload` - CSVアップロード
- `POST /api/prtimes/export` - CSVエクスポート

### セキュリティ
- 管理者権限でのみCSVアップロード可能
- SQLインジェクション対策済み
- CSVパース時のエラーハンドリング

## 使用方法

### CSVアップロード（管理者）
1. `/admin/prtimes`にアクセス
2. CSVファイルを選択
3. アップロードボタンをクリック
4. 結果レポートを確認

### 企業検索（ユーザー）
1. `/prtimes`にアクセス
2. 検索条件を設定
3. 検索ボタンをクリック
4. 結果を確認・エクスポート

### 検索条件例
- 資本金2000万円未満で設立年が2020年より前
- IT業界で東証上場企業
- 特定のプレスリリースカテゴリの企業

## パフォーマンス
- 大量データ対応のインデックス設計
- ページネーション対応
- 効率的なクエリ最適化
- メモリ効率の良いCSV処理